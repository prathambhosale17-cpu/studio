rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Rule 1: Users can read and write any document within their own
    // user-specific folder (e.g., /users/their-own-id/...).
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth.uid == userId;
    }

    // Rule 2: To allow the ID verification search to work, any authenticated
    // user needs permission to query the 'idCards' collection group.
    // 'read' permission includes 'list' (for the query) and 'get' (for the results).
    match /{path=**}/idCards/{cardId} {
      allow read: if request.auth != null;
    }
  }
}
